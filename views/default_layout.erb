<!-- AIzaSyCe5m91hCqrxhyBf2MkUQbUrIZxkB7t99k -->

<!DOCTYPE html>
<html>
<head>
  <title>Drive Safe.ly</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script type="text/javascript"
  src="http://maps.google.com/maps/api/js?sensor=false&amp;language=en"></script>
  <script type="text/javascript" src="gmap3.min.js"> </script>

  <link href="/stylesheets/normalize.css" rel="stylesheet" type="text/css" media="all">
  <link href="/stylesheets/style.css" rel="stylesheet" type="text/css" media="all">
 <!-- <link href="/stylesheets/materialize.css" rel="stylesheet" type="text/css" media="all"> -->
<!-- <link href="/stylesheets/gumby.css" rel="stylesheet" type="text/css" media="all"> -->

</head>
<body>

<!--  <div class="navbar-fixed">
  <nav>
      <div class="nav-wrapper">
        <a href="#" class="brand-logo center">Drive Safe.ly</a>
        <ul id="nav-mobile" class="right hide-on-med-and-down">
          <li><a href="/">Home</a></li>
          <li><a href="#map">Map</a></li>
          <li><a href="#directions_weather">Directions/Weather</a></li>
        </ul>
      </div>
    </nav>
</div> -->

  <nav>
    <div class = "logo">
      <h1 class = "logo2">Drive Safe.ly</h1>
    </div>
    <div class="logo">
      <ul class = "menu">
        <li id = "links"><a href="/">Home</a></li>
        <li id = "links"><a href="#map">Map</a></li>
        <li id = "links"><a href="#directions_weather">Directions/Weather</a></li>
      </ul>
    </div>
  </nav>



  <div class="driving_input">

  <div class="row">
    <h1>Input</h1>
    <form id="direction_inputs" action="form_action.asp">
      Origin: <input type="text" id="origin"  placeholder="ex: Boston, MA" name="origin">
      Destination: <input type="text" id="destination" placeholder="ex: General Assembly, New York, NY" name="destination">

      <input class = "waves-effect waves-light btn" type="submit" id="directions-submit" value="Submit">
    </form>
    <form id="reset_button" action="/">
      <input type="submit" class = "waves-effect waves-light btn" value="Reset">
    </form>
  </div>



  <a name="map"> </a>
  <div id="my_map"></div>
  <a name="directions_weather"> </a>
  <div class ="weather"></div>
  <div class = "last_weather"></div>




  <script>
$("#direction_inputs").on("submit", function(e){
  e.preventDefault();
   var $origin = $("#origin").val();
   var $destination = $("#destination").val();
  console.log($origin);
  console.log($destination);

  $('#my_map').gmap3({
    getroute:{
      options:{
          origin: $origin,
          destination:$destination,
          travelMode: google.maps.DirectionsTravelMode.DRIVING
      },
    callback: function(results){
      var durationOfTripInSeconds = results.routes[0].legs[0].duration.value;
      var startLat  = results.routes[0].legs[0].steps[0]["start_location"]["k"];
      var startLong = results.routes[0].legs[0].steps[0]["start_location"]["D"];
      var endLat  = results.routes[0].legs[0]["end_location"]["k"];
      var endLong = results.routes[0].legs[0]["end_location"]["D"];
      $.ajax({
        url: "/weather",
        type: "GET",
        data: {
          durationOfTripInSeconds,
          startLat: startLat,
          startLong: startLong,
          endLat: endLat,
          endLong: endLong
        },
        dataType: "json"
      }).done(function(data){
        console.log(data);


          var myfirstdata = $('<p>').text("The starting weather is: " + data["first_condition"]+ ", " + data["first_temp"]["english"] + " F, " + data["first_snow"]["english"] + " inches of snow. ")
          var mylastdata = $('<p>').text("The ending weather is: " + data["last_condition"]+ ", " + data["last_temp"]["english"] + " F, " + data["last_snow"]["english"] + " inches of snow. ")

          $('.weather').append(myfirstdata)
          $('.weather').append(mylastdata)

      });
debugger
      if (!results) return;
      $(this).gmap3({
        map:{
          options:{
            zoom: 13,
            center: [-33.879, 151.235]
          }
        },
        // adds traffic layer
        trafficlayer:{
        },
        // renders the directions to a class directions added after the div #my_map
        directionsrenderer:{
          container: $(document.createElement("div")).addClass("directions_weather").insertAfter($("#my_map")),
          options:{
            directions:results

          }
        }
      });
    }
  }
});

});


  </script>


</body>
</html>


